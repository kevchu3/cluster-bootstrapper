---

- name: Setup Base Operators
  hosts: localhost
  connection: local
  gather_facts: yes
  collections:
    - community.okd
    - community.kubernetes

  vars:
    state: present
  
  vars_files:
    - ../vars.yaml

  tasks:

    ## RedHat Supported
    ## Creates OpenShift GitOps Services With Cluster-Admin Permissions
    ## Patches ArgoCD to use kustomize with helm plugin
    ## Optionally - Also installs Image-Updater
    - name: GitOps
      ansible.builtin.include_role:
        name: gitops
      when:
        - openshift.services.gitops.enabled is defined
        - openshift.services.gitops.enabled is true

    ## RedHat Supported
    ## Boots Initial Secrets
    - name: Secrets
      ansible.builtin.include_role:
        name: secrets
      # when:
      #   - openshift.services.gitops.enabled is defined
      #   - openshift.services.gitops.enabled is true

    # Accepts a defined list of repositories and Imports them into GitLab.
    - name: Import Repositories
      ansible.builtin.include_role:
        name: imports
      # when:
      #   - openshift.services.gitlab.enabled is defined
      #   - openshift.services.gitlab.enabled is true

    # RedHat Supported
    # Optionally Creates a Tekton and Signing Secrets
    - name: tekton
      ansible.builtin.include_role:
        name: tekton
      when:
        - openshift.services.tekton.enabled is defined
        - openshift.services.tekton.enabled is true

    # RedHat Supported
    # Optionally Creates a DevHub Instance and connects auth
    - name: rhtas
      ansible.builtin.include_role:
        name: rhtas
      when:
        - openshift.services.rhtas.enabled is defined
        - openshift.services.rhtas.enabled is true

    # RedHat Supported
    # Optionally Creates a DevHub Instance and connects auth
    - name: devhub
      ansible.builtin.include_role:
        name: devhub
      when:
        - openshift.services.devhub.enabled is defined
        - openshift.services.devhub.enabled is true
